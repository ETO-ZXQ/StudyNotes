# 相机

## 相机位姿

### 概念理解

相机位姿是相机在世界坐标系下的位置&姿态。世界坐标系由我们决定，由相机相对于世界坐标系原点的旋转矩阵**R**和平移向量t描述。由此我们得到相机在世界坐标系下的空间位置&姿态。

由于`相机坐标系`原点定义在相机光心，所以相机位姿其实就是`相机坐标系`在`世界坐标系`中的空间位置&姿态。`世界坐标系`下的点向`相机坐标系`下的点的转换便可由旋转矩阵**R**和平移向量t计算。旋转矩阵**R**和平移向量t即相机外参。

## 内参&外参

- **[一文带你搞懂相机内参外参(Intrinsics & Extrinsics) - 知乎](https://zhuanlan.zhihu.com/p/389653208)**

## 摄像头数据输出格式

### RAW

> 这是图像传感器捕获的原始数据，没有经过任何处理或压缩，通常以二进制形式存储。这种格式的数据包含了最大范围的信息，但其文件会很大。

### YUV

> 这种格式将图像的亮度信息（**Y**）和颜色信息（**U** 和 **V**）分离开，这样可以根据需要对这两种信息进行不同程度的压缩。常见的有YUV420、YUV422和YUV444等。

### RGB

> 这种格式将图像分为红色、绿色和蓝色三个通道，每个像素由红、绿、蓝三个分量表示，通常使用24位或32位的数据表示。颜色的变化和复杂性可以得到很好的保留，但文件大小相比YUV会大一些。

### JPEG

> 这种格式使用了一种名为离散余弦变换的技术对图像进行压缩，以减少文件的大小。然而，这种压缩是有损的，意味着一些图像信息将会丢失。

### MJPEG

> 使用JPEG压缩算法对每帧图像进行压缩，输出为一系列JPEG图像。这种格式是对一系列JPEG图像的简单封装，用于视频流。

### H.264/AVC、H.265/HEVC等

> 视频压缩标准（视频编码标准），可以有效地压缩视频数据，使其在保持高画质的同时，占用较小的存储空间和带宽。输出为压缩后的视频流。

### 深度数据

> 通常深度数据使用整形数进行表示，范围在0-65535之间，类型为UINT16，即unsigned short，无符号2字节。单位为毫米mm。

## 相机基础知识&robomaster视觉任务梳理

> 与李轩学长的交流总结

### 基础知识

1. `我们得到的相机图像是有畸变的，在自动识别，神经网络处理时均不修正！` *（理想的小孔成像模型，物和像满足相似三角形的关系。实际上由于相机光学系统制造工艺的误差，实际成像与理想成像存在几何失真，称为畸变。畸变主要分为径向畸变和切向畸变）*

2. 相机坐标系：以`光心`（凸透镜中心、小孔成像的孔）为坐标原点。一般沿主光轴向外为Z轴；水平向右为X轴；竖直向下为Y轴。

3. 归一化平面：原像素（成像）平面（小孔成像中倒着的蜡烛）（ ， ，-f）关于`光心`，对称翻转后的像素的平面（x，y，f）再归一化，使坐标为（x/f，y/f，1）。【`相机坐标系下的坐标`】

4. 一般想要得到`目标物体`相对于自己（相机）的位置，所以世界坐标系一般建在`目标物体`上。

### 步兵视觉任务梳理

![robomaster步兵](./images/robomaster步兵.png "robomaster步兵")

目标：得到敌方机器人装甲板相对于自己的位置。

相机坐标系：以摄像头`光心`为坐标原点。沿枪管射出方向为Z轴；水平向右为X轴；竖直向上为Y轴。

世界坐标系：以`敌方`装甲板中心为坐标原点。装甲板法线方向向外为Z轴；水平向右为X轴；竖直向上为Y轴。

（坐标系XYZ轴方向学长们定的）

#### **任务流程：**

1. 获取`我方`相机图像。（有畸变，未修正）
2. 神经网络处理得到装甲板`像素坐标`。
3. 相机畸变修正，（仅对`像素坐标`那几个点），得到`正确的，修正后的，像素坐标`。
4. 再得到`相机坐标系下的坐标`。
5. 由于装甲板尺寸已知，所以装甲板四端点`世界坐标`已知。通过装甲板四端点`相机坐标系下的坐标`与`世界坐标`对应关系得`世界坐标系`对`相机坐标系`的`旋转矩阵`and`平移向量`。
6. `平移向量`即得到了`敌方机器人装甲板相对于自己的位置`。

### 双相机

![双相机原理-1](./images/双相机原理-1.png "双相机原理-1")

- C1、C2：两相机的`光心`。

- O1、O2：关于`光心`翻转后的像素（成像）平面中心。

![双相机原理-2](./images/双相机原理-2.png "双相机原理-2")
